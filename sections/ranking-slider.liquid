{{ 'swiper.css' | asset_url | stylesheet_tag }}

<ranking-slider-section>
    <div class="ranking-slider-section">
        <div class="ranking-slider page-width">

            <div class="ranking-slider__title-wrapper">
                {%- render 'section-title',
                    heading: section.settings.heading,
                    subheading: section.settings.subheading,
                    text_alignment: 'left'
                -%}
                {%- if section.settings.collection.url != blank and section.settings.button_label != blank -%}
                    <div class="ranking-slider__button-wrapper">
                        {%- render 'button-custom', label: section.settings.button_label, url: section.settings.collection.url -%}
                    </div>
                {%- endif -%}
            </div>

            <div class="swiper ranking-slider__swiper">
                <div class="swiper-wrapper">
                    {%- liquid
                        assign collection = section.settings.collection
                        assign product_limit = section.settings.products_to_show
                    -%}
                    {%- if collection.products.size > 0 -%}
                        {%- for product in collection.products limit: product_limit -%}
                            <div class="swiper-slide">
                                <div class="ranking-card">
                                    {%- render 'card-product-custom', product_card: product, rank: forloop.index -%}
                                </div>
                            </div>
                        {%- endfor -%}
                    {%- else -%}
                        {%- for i in (1..product_limit) -%}
                            <div class="swiper-slide">
                                <div class="ranking-card">
                                    {%- render 'card-product-custom', index: i, rank: i -%}
                                </div>
                            </div>
                        {%- endfor -%}
                    {%- endif -%}
                </div>

                <div class="swiper-button-prev"></div>
                <div class="swiper-button-next"></div>
            </div>

        </div>
    </div>
</ranking-slider-section>

<script src="{{ 'swiper.js' | asset_url }}" defer="defer"></script>

{%- javascript -%}
    class RankingSlider extends HTMLElement {
        constructor() {
            super();
            if (document.readyState === 'loading') {
                document.addEventListener('DOMContentLoaded', this.init.bind(this));
            } else {
                this.init();
            }
        }
        init() {
            this.swiperElement = this.querySelector('.swiper');
            if (!this.swiperElement || typeof Swiper === 'undefined') return;

            const swiper = new Swiper(this.swiperElement, {
                loop: false,
                slidesPerView: 1.5,
                spaceBetween: 15,
                navigation: { nextEl: '.swiper-button-next', prevEl: '.swiper-button-prev' },
                breakpoints: {
                    750: { slidesPerView: 3, spaceBetween: 20 },
                    990: { slidesPerView: 4, spaceBetween: 30 },
                },
            });
        }
    }
    customElements.define('ranking-slider-section', RankingSlider);
{%- endjavascript -%}

{% schema %}
{
    "name": "【カスタム】ランキング",
    "class": "shopify-section--ranking-slider",
    "settings": [
        { "type": "text", "id": "heading", "label": "見出し", "default": "ランキング" },
        { "type": "text", "id": "subheading", "label": "背景のテキスト", "default": "RANKING" },
        { "type": "collection", "id": "collection", "label": "表示するコレクション" },
        { "type": "range", "id": "products_to_show", "min": 4, "max": 12, "step": 1, "default": 8, "label": "表示する最大商品数" },
        { "type": "text", "id": "button_label", "label": "ボタンのラベル", "default": "詳しく見る" }
    ],
    "presets": [ { "name": "【カスタム】ランキング" } ]
}
{% endschema %}