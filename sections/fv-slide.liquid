{% comment %} 
  このセクションでSwiper.jsを使用します。
  theme.liquidで既に読み込まれている場合は不要ですが、
  セクションの独立性を保つために記述しておきます。
{% endcomment %}
{{ 'swiper.js' | asset_url | script_tag }}

<fv-slider-section class="fv-wrap">
  <div class="swiper swiper-fv-container">
    <div class="swiper-wrapper">
      {%- for block in section.blocks -%}
        <div class="swiper-slide">
          {%- liquid
            assign has_link = false
            if block.settings.my_url_name != blank
              assign has_link = true
            endif
          -%}
          {%- if has_link -%}
            <a class="link" href="{{ block.settings.my_url_name }}">
          {%- endif -%}
          
          <div class="fv-img-wrapper">
            {%- liquid
              assign mobile_image = block.settings.swiper_img_sp
              assign desktop_image = block.settings.swiper_img_pc
            -%}
            
            <picture>
              {%- if mobile_image != blank -%}
                <source media="(max-width: 767px)" srcset="{{ mobile_image | image_url: width: 1200 }}">
              {%- endif -%}
              <img 
                class="ofi -cover" 
                src="{{ desktop_image | image_url: width: 2400 }}" 
                alt="{{ desktop_image.alt | escape }}"
                loading="eager"
                fetchpriority="high"
                width="{{ desktop_image.width }}"
                height="{{ desktop_image.height }}"
              >
            </picture>
          </div>

          {%- if has_link -%}
            </a>
          {%- endif -%}
        </div>
      {%- endfor -%}
    </div>
    <div class="swiper-pagination"></div>
  </div>
</fv-slider-section>

{%- javascript -%}
  class FvSlider extends HTMLElement {
    constructor() {
      super();
      this.swiperContainer = this.querySelector('.swiper-fv-container');
      if (!this.swiperContainer || typeof Swiper === 'undefined') return;

      this.initSwiper();
    }

    initSwiper() {
      const swiper = new Swiper(this.swiperContainer, {
        effect: "fade",
        loop: true,
        speed: 2000,
        autoplay: { 
          delay: 4000, 
          disableOnInteraction: false 
        },
        pagination: {
          el: '.swiper-pagination',
          clickable: true
        }
      });
    }
  }
  customElements.define('fv-slider-section', FvSlider);
{%- endjavascript -%}

{% schema %}
{
  "name":  "FVスライド",
  "class": "index-section--slideshow-swiper",
  "max_blocks": 10,
  "blocks": [
    {
      "type": "image_picker",
      "name":  "スライド画像",
      "settings": [
        {
          "type": "image_picker",
          "id": "swiper_img_pc",
          "label":"画像（PC）"
        },
        {
          "type": "image_picker",
          "id": "swiper_img_sp",
          "label":"画像（スマホ）",
          "info": "設定しない場合はPCと同じ画像が表示されます。"
        },
        {
          "type": "url",
          "id": "my_url_name",
          "label": "リンク先URL"
        }
      ]
    }
  ],
  "presets": [
    {
      "name": "FVスライド",
      "category": "画像"
    }
  ]
}
{% endschema %}