{%- style -%}
    #shopify-section-{{ section.id }} .featured-collection {
        --padding-top-desktop: {{ section.settings.padding_top_desktop }}px;
        --padding-bottom-desktop: {{ section.settings.padding_bottom_desktop }}px;
        --padding-top-mobile: {{ section.settings.padding_top_mobile }}px;
        --padding-bottom-mobile: {{ section.settings.padding_bottom_mobile }}px;
    }
{%- endstyle -%}

{% comment %} Swiper.jsのCSSファイルを読み込みます {% endcomment %}
{{ 'swiper.css' | asset_url | stylesheet_tag }}

<featured-collection-slider>
    <div class="featured-collection-slider">
        <div class="featured-collection page-width">

            {%- render 'section-title',
                heading: section.settings.heading,
                subheading: section.settings.subheading,
                text_alignment: section.settings.title_text_alignment,
                padding_top: section.settings.title_padding_top,
                padding_bottom: section.settings.title_padding_bottom
            -%}

            {% comment %} Swiper.js用のHTML構造 {% endcomment %}
            <div class="swiper featured-collection__slider">
                <div class="swiper-wrapper">
                    {%- liquid
                        assign collection = section.settings.collection
                        assign product_limit = section.settings.products_to_show
                    -%}
                    {%- if collection.products.size > 0 -%}
                        {%- for product in collection.products limit: product_limit -%}
                            <div class="swiper-slide">
                                {%- render 'card-product-custom', product_card: product -%}
                            </div>
                        {%- endfor -%}
                    {%- else -%}
                        {%- for i in (1..product_limit) -%}
                            <div class="swiper-slide">
                                {%- render 'card-product-custom', index: i -%}
                            </div>
                        {%- endfor -%}
                    {%- endif -%}
                </div>

                {% comment %} 矢印ナビゲーション {% endcomment %}
                <div class="swiper-button-prev"></div>
                <div class="swiper-button-next"></div>
            </div>

            {%- if section.settings.button_label != blank and section.settings.collection.url != blank -%}
                <div class="featured-collection__button-wrapper">
                    {%- render 'button-custom', label: section.settings.button_label, url: section.settings.collection.url -%}
                </div>
            {%- endif -%}
        </div>
    </div>
</featured-collection-slider>

{% comment %} Swiper.jsのJavaScriptファイルを読み込みます {% endcomment %}
<script src="{{ 'swiper.js' | asset_url }}" defer="defer"></script>

{%- javascript -%}
    class FeaturedCollectionSlider extends HTMLElement {
        constructor() {
            super();
            // DOMの準備ができたら初期化する
            if (document.readyState === 'loading') {
                document.addEventListener('DOMContentLoaded', this.init.bind(this));
            } else {
                this.init();
            }
        }

        init() {
            this.swiperElement = this.querySelector('.swiper');
            if (!this.swiperElement || typeof Swiper === 'undefined') return;

            const swiper = new Swiper(this.swiperElement, {
                loop: false,
                slidesPerView: 1.5,
                spaceBetween: 7.5,
                navigation: {
                    nextEl: '.swiper-button-next',
                    prevEl: '.swiper-button-prev',
                },
                breakpoints: {
                    750: {
                        slidesPerView: 3,
                        spaceBetween: 20,
                    },
                    990: {
                        slidesPerView: 3.5,
                        spaceBetween: 30,
                    },
                },
            });
        }
    }
    customElements.define('featured-collection-slider', FeaturedCollectionSlider);
{%- endjavascript -%}

{% schema %}
{
    "name": "【カスタム】特集コレクション",
    "class": "shopify-section--featured-collection",
    "settings": [
        {
            "type": "text",
            "id": "heading",
            "label": "見出し",
            "default": "空間を引き立てる大きな植物"
        },
        {
            "type": "text",
            "id": "subheading",
            "label": "背景のテキスト",
            "default": "BIG BOTANICAL"
        },
        {
            "type": "header",
            "content": "セクションの余白"
        },
        {
            "type": "range",
            "id": "padding_top_desktop",
            "min": 0,
            "max": 200,
            "step": 10,
            "unit": "px",
            "label": "上の余白（PC）",
            "default": 30
        },
        {
            "type": "range",
            "id": "padding_bottom_desktop",
            "min": 0,
            "max": 200,
            "step": 10,
            "unit": "px",
            "label": "下の余白（PC）",
            "default": 30
        },
        {
            "type": "range",
            "id": "padding_top_mobile",
            "min": 0,
            "max": 100,
            "step": 5,
            "unit": "px",
            "label": "上の余白（スマホ）",
            "default": 20
        },
        {
            "type": "range",
            "id": "padding_bottom_mobile",
            "min": 0,
            "max": 100,
            "step": 5,
            "unit": "px",
            "label": "下の余白（スマホ）",
            "default": 20
        },
        {
            "type": "header",
            "content": "タイトルの余白"
        },
        {
            "type": "select",
            "id": "title_text_alignment",
            "label": "タイトルの配置",
            "options": [
                { "value": "center", "label": "中央揃え" },
                { "value": "left", "label": "左揃え" }
            ],
            "default": "center"
        },
        {
            "type": "range",
            "id": "title_padding_top",
            "min": 0,
            "max": 200,
            "step": 10,
            "unit": "px",
            "label": "上の余白（PC）",
            "default": 30
        },
        {
            "type": "range",
            "id": "title_padding_bottom",
            "min": 0,
            "max": 200,
            "step": 10,
            "unit": "px",
            "label": "下の余白（PC）",
            "default": 30
        },
        {
            "type": "collection",
            "id": "collection",
            "label": "表示するコレクション"
        },
        {
            "type": "range",
            "id": "products_to_show",
            "min": 4,
            "max": 20,
            "step": 1,
            "default": 8,
            "label": "表示する最大商品数"
        },
        {
            "type": "text",
            "id": "button_label",
            "label": "ボタンのラベル",
            "default": "詳しく見る"
        },
        {
            "type": "url",
            "id": "button_link",
            "label": "ボタンのリンク"
        }
    ],
    "presets": [
        {
            "name": "【カスタム】特集コレクション"
        }
    ]
}
{% endschema %}