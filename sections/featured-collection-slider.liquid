{% comment %} Swiper.jsのCSSファイルを読み込みます {% endcomment %}
{{ 'swiper.css' | asset_url | stylesheet_tag }}

<featured-collection-slider>
    <div class="featured-collection-slider">
        <div class="featured-collection page-width">
            {%- if section.settings.heading != blank or section.settings.subheading != blank -%}
                <div class="featured-collection__title-wrapper">
                    {%- if section.settings.heading != blank -%}
                        <h2 class="featured-collection__heading">{{ section.settings.heading }}</h2>
                    {%- endif -%}
                    {%- if section.settings.subheading != blank -%}
                        <p class="featured-collection__subheading cinzel">{{ section.settings.subheading }}</p>
                    {%- endif -%}
                </div>
            {%- endif -%}

            {% comment %} Swiper.js用のHTML構造 {% endcomment %}
            <div class="swiper featured-collection__slider">
                <div class="swiper-wrapper">
                    {%- liquid
                        assign collection = section.settings.collection
                        assign product_limit = section.settings.products_to_show
                    -%}
                    {%- if collection.products.size > 0 -%}
                        {%- for product in collection.products limit: product_limit -%}
                            <div class="swiper-slide">
                                {%- render 'card-product-custom', product_card: product -%}
                            </div>
                        {%- endfor -%}
                    {%- else -%}
                        {%- for i in (1..product_limit) -%}
                            <div class="swiper-slide">
                                {%- render 'card-product-custom', index: i -%}
                            </div>
                        {%- endfor -%}
                    {%- endif -%}
                </div>

                {% comment %} 矢印ナビゲーション {% endcomment %}
                <div class="swiper-button-prev"></div>
                <div class="swiper-button-next"></div>
            </div>

            {%- if section.settings.button_label != blank and section.settings.button_link != blank -%}
                <div class="featured-collection__button-wrapper">
                    <a href="{{ section.settings.button_link }}" class="button button--secondary">
                        {{ section.settings.button_label }}
                    </a>
                </div>
            {%- endif -%}
        </div>
    </div>
</featured-collection-slider>

{% comment %} Swiper.jsのJavaScriptファイルを読み込みます {% endcomment %}
<script src="{{ 'swiper.js' | asset_url }}" defer="defer"></script>

{%- javascript -%}
    class FeaturedCollectionSlider extends HTMLElement {
        constructor() {
            super();
            // DOMの準備ができたら初期化する
            if (document.readyState === 'loading') {
                document.addEventListener('DOMContentLoaded', this.init.bind(this));
            } else {
                this.init();
            }
        }

        init() {
            this.swiperElement = this.querySelector('.swiper');
            if (!this.swiperElement || typeof Swiper === 'undefined') return;

            const swiper = new Swiper(this.swiperElement, {
                loop: false,
                slidesPerView: 1.5,
                spaceBetween: 7.5,
                navigation: {
                    nextEl: '.swiper-button-next',
                    prevEl: '.swiper-button-prev',
                },
                breakpoints: {
                    750: {
                        slidesPerView: 3,
                        spaceBetween: 20,
                    },
                    990: {
                        slidesPerView: 3.5,
                        spaceBetween: 30,
                    },
                },
            });
        }
    }
    customElements.define('featured-collection-slider', FeaturedCollectionSlider);
{%- endjavascript -%}

{% schema %}
{
    "name": "【カスタム】特集コレクション",
    "class": "shopify-section--featured-collection",
    "settings": [
        {
            "type": "text",
            "id": "heading",
            "label": "見出し",
            "default": "空間を引き立てる大きな植物"
        },
        {
            "type": "text",
            "id": "subheading",
            "label": "背景のテキスト",
            "default": "BIG BOTANICAL"
        },
        {
            "type": "collection",
            "id": "collection",
            "label": "表示するコレクション"
        },
        {
            "type": "range",
            "id": "products_to_show",
            "min": 4,
            "max": 20,
            "step": 1,
            "default": 8,
            "label": "表示する最大商品数"
        },
        {
            "type": "text",
            "id": "button_label",
            "label": "ボタンのラベル",
            "default": "詳しく見る"
        },
        {
            "type": "url",
            "id": "button_link",
            "label": "ボタンのリンク"
        }
    ],
    "presets": [
        {
            "name": "【カスタム】特集コレクション"
        }
    ]
}
{% endschema %}