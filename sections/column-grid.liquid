{%- style -%}
    #shopify-section-{{ section.id }} {
        --column-grid-padding-top-desktop: {{ section.settings.padding_top_desktop }}px;
        --column-grid-padding-bottom-desktop: {{ section.settings.padding_bottom_desktop }}px;
        --column-grid-padding-top-mobile: {{ section.settings.padding_top_mobile }}px;
        --column-grid-padding-bottom-mobile: {{ section.settings.padding_bottom_mobile }}px;
        --column-grid-background-color: {{ section.settings.background_color }};
    }
{%- endstyle -%}

{%- assign blog = section.settings.blog -%}
{%- assign article_limit = section.settings.articles_to_show -%}

<section class="column-grid">
    <div class="column-grid__inner page-width">
        <div class="column-grid__title-wrapper">
            {%- render 'section-title',
                heading: section.settings.heading,
                subheading: section.settings.subheading,
                text_alignment: section.settings.title_text_alignment,
                padding_top: section.settings.title_padding_top,
                padding_bottom: section.settings.title_padding_bottom,
                subheading_color: section.settings.title_subheading_color
            -%}

            {%- assign button_url = section.settings.button_link -%}
            {%- if button_url == blank and blog != blank -%}
                {%- assign button_url = blog.url -%}
            {%- endif -%}

            {%- if section.settings.button_label != blank and button_url != blank -%}
                <div class="column-grid__button-wrapper">
                    {%- render 'button-custom', label: section.settings.button_label, url: button_url, class: 'button-custom--outline' -%}
                </div>
            {%- endif -%}
        </div>

        <div class="column-grid__items">
            {%- if blog != blank and blog.articles_count > 0 -%}
                {%- for article in blog.articles limit: article_limit -%}
                    <article class="column-grid__item">
                        <a class="column-grid__link" href="{{ article.url }}">
                            <div class="column-grid__image{% if article.image == blank %} column-grid__image--placeholder{% endif %}">
                                {%- if article.image != blank -%}
                                    {%- assign article_image_alt = article.image.alt | default: article.title -%}
                                    {{ article.image | image_url: width: 900 | image_tag: loading: 'lazy', alt: article_image_alt }}
                                {%- endif -%}
                            </div>

                            <div class="column-grid__content">
                                <h3 class="column-grid__title">{{ article.title }}</h3>
                                <time class="column-grid__date" datetime="{{ article.published_at | date: '%Y-%m-%d' }}">{{ article.published_at | date: '%Y.%m.%d' }}</time>
                            </div>
                        </a>
                    </article>
                {%- endfor -%}
            {%- else -%}
                {%- assign placeholder_count = article_limit | default: 4 -%}
                {%- if placeholder_count < 1 -%}
                    {%- assign placeholder_count = 4 -%}
                {%- endif -%}
                {%- for i in (1..placeholder_count) -%}
                    <article class="column-grid__item">
                        <div class="column-grid__image column-grid__image--placeholder"></div>
                        <div class="column-grid__content">
                            <h3 class="column-grid__title">サンプルタイトル {{ i }}</h3>
                            <p class="column-grid__excerpt">ここに説明文が入ります。コンテンツを追加してください。</p>
                            <time class="column-grid__date">2025.00.00</time>
                        </div>
                    </article>
                {%- endfor -%}
            {%- endif -%}
        </div>
    </div>
</section>

{% schema %}
{
    "name": "【カスタム】コラムグリッド",
    "class": "section-column-grid",
    "settings": [
        {
            "type": "color",
            "id": "background_color",
            "label": "背景色",
            "default": "#ffffff"
        },
        {
            "type": "text",
            "id": "heading",
            "label": "見出し",
            "default": "読みもの"
        },
        {
            "type": "text",
            "id": "subheading",
            "label": "背景のテキスト",
            "default": "COLUMN"
        },
        {
            "type": "color",
            "id": "title_subheading_color",
            "label": "背景テキストの色",
            "default": "#f4f5f5"
        },
        {
            "type": "select",
            "id": "title_text_alignment",
            "label": "タイトルの配置",
            "options": [
                { "value": "left", "label": "左揃え" },
                { "value": "center", "label": "中央揃え" }
            ],
            "default": "left"
        },
        {
            "type": "range",
            "id": "title_padding_top",
            "min": 0,
            "max": 120,
            "step": 5,
            "unit": "px",
            "label": "タイトル上の余白",
            "default": 40
        },
        {
            "type": "range",
            "id": "title_padding_bottom",
            "min": 0,
            "max": 120,
            "step": 5,
            "unit": "px",
            "label": "タイトル下の余白",
            "default": 40
        },
        {
            "type": "blog",
            "id": "blog",
            "label": "表示するブログ"
        },
        {
            "type": "range",
            "id": "articles_to_show",
            "label": "表示する記事数",
            "min": 2,
            "max": 12,
            "step": 1,
            "default": 4
        },
        {
            "type": "text",
            "id": "button_label",
            "label": "ボタンのラベル",
            "default": "詳しく見る"
        },
        {
            "type": "url",
            "id": "button_link",
            "label": "ボタンのリンク先"
        },
        {
            "type": "range",
            "id": "padding_top_desktop",
            "min": 0,
            "max": 240,
            "step": 10,
            "unit": "px",
            "label": "上の余白（PC）",
            "default": 120
        },
        {
            "type": "range",
            "id": "padding_bottom_desktop",
            "min": 0,
            "max": 240,
            "step": 10,
            "unit": "px",
            "label": "下の余白（PC）",
            "default": 120
        },
        {
            "type": "range",
            "id": "padding_top_mobile",
            "min": 0,
            "max": 200,
            "step": 10,
            "unit": "px",
            "label": "上の余白（スマホ）",
            "default": 80
        },
        {
            "type": "range",
            "id": "padding_bottom_mobile",
            "min": 0,
            "max": 200,
            "step": 10,
            "unit": "px",
            "label": "下の余白（スマホ）",
            "default": 80
        }
    ],
    "blocks": [
        {
            "type": "column",
            "name": "コラム (非推奨)",
            "settings": []
        }
    ],
    "presets": [
        {
            "name": "【カスタム】コラムグリッド"
        }
    ]
}
{% endschema %}
